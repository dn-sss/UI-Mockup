@{
    ViewData["Title"] = "AITRIOS Console Mockup Demo";
}

<div class="container-fluid">
    <div class="row" style="padding-top: 0.25em;">
        <!-- Camera 1 -->
        <div class="col-12 col-sm-4 col-md-4 my-col">
            <div class="card card-default my-card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i id="camera_1_wifi_icon" class="fa-solid fa-wifi fa-wifi-connected"></i>
                        <span id="camera_1_name"></span>
                    </h3>
                    <div class="card-tools">
                        <button type="button" class="btn btn-tool" data-card-widget="collapse">
                            <i class="fas fa-minus"></i>
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="callout callout-info">
                        <h5>
                            <i class="fa-solid fa-brain "></i>
                            AI Model
                        </h5>
                        <div>
                            Select AI Model
                        </div>

                        <select name="modelListCamera1" id="modelListCamera1" class="form-control custom-select">
                            <option value="people" selected>People Detection</option>
                            <option value="box">Box Detection</option>
                            <option value="car">Car Detection</option>
                        </select>
                    </div>

                    <div class="callout callout-info">
                        <h5>
                            <i class="fa-solid fa-sliders"></i>
                            Inference Threshold
                        </h5>

                        <div>
                            <div class="slider-aitrios" style="overflow:auto">
                                <label class="label-threshold" for="SliderConfidenceLevelCamera1">Current Threshold : <span id="SpanConfidenceLevelCamera1">10</span><span>%</span></label>
                                <input type="range" class="slider" min="0" max="100" value="80" step="1" id="SliderConfidenceLevelCamera1" style="width:100%">
                            </div>
                        </div>
                    </div>
                    <div class="callout callout-info">
                        <h5>
                            <i class="fas fa-play-circle"></i>
                            AI Inference
                        </h5>
                        <div>
                            Start/Stop AI Inference
                        </div>
                        <input type="checkbox" name="aiSwtichCamera1" data-handle-width="100" data-bootstrap-switch data-off-color="danger" data-on-color="success" data-on-text="Running" data-off-text="Stopped">
                    </div>
                    <div class="callout callout-info" style="margin-top:0.1em">
                        <h5>
                            <i class="fas fa-poll"></i>
                            Results
                        </h5>
                        <div class="row" style="color:red">
                            <div class="col-4 col-sm-4 col-md-4">
                                <div style="text-align:right">
                                    <strong># of xxx detected</strong>
                                </div>
                                <div style="text-align:right">
                                    <strong>Average Power Consumption</strong>
                                </div>
                            </div>
                            <div class="col-4 col-sm-4 col-md-4">
                                <div>
                                    <pre class="pre-inline" style="color:red"> abcd</pre>
                                </div>
                                <div style="color:red">
                                    <pre class="pre-inline" style="color:red"><pre class="pre-inline" style="color:red">xyz</pre> Wh</pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="callout callout-info">
                        <h5>
                            <i class="fa-solid fa-images"></i>
                            Image
                        </h5>
                        <div class="container loader-parent my-div-image">
                            <div class="row justify-content-center align-items-center">
                                <canvas id="canvasCamera1Overlay" height="320" width="320" style="max-width:320px;max-height:320px;z-index:300"></canvas>
                                <canvas id="canvasCamera1" height="320" width="320" style="max-width:320px;max-height:320px;z-index:100;position:absolute"></canvas>
                            </div>
                            <div id="canvasCamera1LoaderWrapper" class="canvasLoaderWrapper" height="320" width="320" style="display:block">
                                <div class="canvasLoader">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Camera 2 -->
        <div class="col-12 col-sm-4 col-md-4 my-col">
            <div class="card card-default my-card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i id="camera_2_wifi_icon" class="fa-solid fa-wifi fa-wifi-connected"></i>
                        <span id="camera_2_name"></span>
                    </h3>
                    <div class="card-tools">
                        <button type="button" class="btn btn-tool" data-card-widget="collapse">
                            <i class="fas fa-minus"></i>
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="callout callout-info">
                        <h5>
                            <i class="fa-solid fa-brain"></i>
                            AI Model
                        </h5>
                        <div>
                            Select AI Model
                        </div>

                        <select name="modelListCamera2" id="modelListCamera2" class="form-control custom-select">
                            <option value="people">People Detection</option>
                            <option value="box" selected>Box Detection</option>
                            <option value="car">Car Detection</option>
                        </select>
                    </div>

                    <div class="callout callout-info">
                        <h5>
                            <i class="fa-solid fa-sliders"></i>
                            Inference Threshold
                        </h5>
                        <div>
                            <div class="slider-aitrios" style="overflow:auto">
                                <label class="label-threshold" for="SliderConfidenceLevelCamera2">Current Threshold : <span id="SpanConfidenceLevelCamera2">10</span><span>%</span></label>
                                <input type="range" class="slider" min="0" max="100" value="80" step="1" id="SliderConfidenceLevelCamera2" style="width:100%">
                            </div>
                        </div>
                    </div>
                    <div class="callout callout-info">
                        <h5>
                            <i class="fas fa-play-circle"></i>
                            AI Inference
                        </h5>
                        <div>
                            Start/Stop AI Inference
                        </div>
                        <input type="checkbox" name="aiSwtichCamera2" data-handle-width="100" data-bootstrap-switch data-off-color="danger" data-on-color="success" data-on-text="Running" data-off-text="Stopped">
                    </div>
                    <div class="callout callout-info" style="margin-top:0.1em">
                        <h5>
                            <i class="fas fa-poll"></i>
                            Results
                        </h5>
                        <div class="row" style="color:red">
                            <div class="col-4 col-sm-4 col-md-4">
                                <div style="text-align:right">
                                    <strong># of xxx detected</strong>
                                </div>
                                <div style="text-align:right">
                                    <strong>Average Power Consumption</strong>
                                </div>
                            </div>
                            <div class="col-4 col-sm-4 col-md-4">
                                <div>
                                    <pre class="pre-inline" style="color:red"> abcd</pre>
                                </div>
                                <div style="color:red">
                                    <pre class="pre-inline" style="color:red"><pre class="pre-inline" style="color:red">xyz</pre> Wh</pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="callout callout-info" style="margin-bottom:0.5em">
                        <h5>
                            <i class="fa-solid fa-images"></i>
                            Image
                        </h5>
                        <div class="container loader-parent my-div-image" height="320" width="320">
                            <div class="row justify-content-center align-items-center">
                                <canvas id="canvasCamera2Overlay" height="320" width="320" style="max-width:320px;max-height:320px;z-index:300"></canvas>
                                <canvas id="canvasCamera2" height="320" width="320" style="max-width:320px;max-height:320px;z-index:100;position:absolute"></canvas>
                            </div>
                            <div id="canvasCamera2LoaderWrapper" class="canvasLoaderWrapper" height="320" width="320" style="display:block">
                                <div class="canvasLoader">
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <!-- Camera 3-->
        <div class="col-12 col-sm-4 col-md-4 my-col">
            <div class="card card-default my-card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i id="camera_3_wifi_icon" class="fa-solid fa-wifi fa-wifi-disconnected"></i>
                        <span id="camera_3_name"></span>
                    </h3>
                    <div class="card-tools">
                        <button type="button" class="btn btn-tool" data-card-widget="collapse">
                            <i class="fas fa-minus"></i>
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="callout callout-info">
                        <h5>
                            <i class="fa-solid fa-brain"></i>
                            AI Model
                        </h5>
                        <div>
                            Select AI Model
                        </div>

                        <select name="modelListCamera3" id="modelListCamera3" class="form-control custom-select">
                            <option value="people">People Detection</option>
                            <option value="box">Box Detection</option>
                            <option value="car" selected>Car Detection</option>
                        </select>
                    </div>

                    <div class="callout callout-info">
                        <h5>
                            <i class="fa-solid fa-sliders"></i>
                            Inference Threshold
                        </h5>
                        <div>
                            <div class="slider-aitrios" style="overflow:auto">
                                <label class="label-threshold" for="SliderConfidenceLevelCamera3">Current Threshold : <span id="SpanConfidenceLevelCamera3">10</span><span>%</span></label>
                                <input type="range" class="slider" min="0" max="100" value="80" step="1" id="SliderConfidenceLevelCamera3" style="width:100%">
                            </div>
                        </div>
                    </div>
                    <div class="callout callout-info">
                        <h5>
                            <i class="fas fa-play-circle"></i>
                            AI Inference
                        </h5>
                        <div>
                            Start/Stop AI Inference
                        </div>
                        <input type="checkbox" name="aiSwtichCamera3" data-handle-width="100" data-bootstrap-switch data-off-color="danger" data-on-color="success" data-on-text="Running" data-off-text="Stopped">
                    </div>
                    <div class="callout callout-info" style="margin-top:0.1em">
                        <h5>
                            <i class="fas fa-poll"></i>
                            Results
                        </h5>
                        <div class="row" style="color:red">
                            <div class="col-4 col-sm-4 col-md-4">
                                <div style="text-align:right">
                                    <strong># of xxx detected</strong>
                                </div>
                                <div style="text-align:right">
                                    <strong>Average Power Consumption</strong>
                                </div>
                            </div>
                            <div class="col-4 col-sm-4 col-md-4">
                                <div>
                                    <pre class="pre-inline" style="color:red"> abcd</pre>
                                </div>
                                <div style="color:red">
                                    <pre class="pre-inline" style="color:red"><pre class="pre-inline" style="color:red">xyz</pre> Wh</pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="callout callout-info" style="margin-bottom:0.5em">
                        <h5>
                            <i class="fa-solid fa-images"></i>
                            Image
                        </h5>
                        <div class="container loader-parent my-div-image" height="320" width="320">
                            <div class="row justify-content-center align-items-center">
                                <canvas id="canvasCamera3Overlay" height="320" width="320" style="max-width:320px;max-height:320px;z-index:300"></canvas>
                                <canvas id="canvasCamera3" height="320" width="320" style="max-width:320px;max-height:320px;z-index:100;position:absolute"></canvas>
                            </div>
                            <div id="canvasCamera3LoaderWrapper" class="canvasLoaderWrapper" height="320" width="320" style="display:block">
                                <div class="canvasLoader">
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
    <div id="divLog" class="row" style="padding-top: 0.25em;padding-bottom: 0.25em;">
        <div class="col-12 col-sm-12 col-md-12 my-col">
            <div class="card card-default my-card">
                <div class="card-header" style="background-color:#fff !important">
                    <div class="card-tools">
                        <button type="button" class="btn" id="btnClearLogs">
                            <i class="far fa-trash-alt btn-fa"></i>Clear Logs
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div style="width:100%">
                        <textarea id="txAreaStatus" title="Log Display Area" style="width:100%;height:20em;min-height:7em;font-size:0.8em;font-family:monospace;"></textarea>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section scripts
    {
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script type="text/javascript" src="/lib/microsoft/signalr/dist/browser/signalr.min.js"></script>
    <script type="text/javascript" src="/js/site.js"></script>


    <script type="text/javascript">

        let canvasCamera1;
        let canvasContextCamera1;
        let resizeObserver;
        let sliderThresholdCamera1 = document.getElementById("SliderConfidenceLevelCamera1");
        let sliderThresholdCamera2 = document.getElementById("SliderConfidenceLevelCamera2");
        let sliderThresholdCamera3 = document.getElementById("SliderConfidenceLevelCamera3");
        let sliderThresholdValueCamera1 = document.getElementById("SpanConfidenceLevelCamera1");
        let sliderThresholdValueCamera2 = document.getElementById("SpanConfidenceLevelCamera2");
        let sliderThresholdValueCamera3 = document.getElementById("SpanConfidenceLevelCamera3");
        let signalRHub;

        window.onload = function () {
        };

        $(document).ready(function () {

            let camera1_id = '@(ViewData["Camera1_ID"])';
            let camera2_id = '@(ViewData["Camera2_ID"])'
            let camera3_id = '@(ViewData["Camera3_ID"])';

            //
            //
            // Slider
            //
            SpanConfidenceLevelCamera1.innerHTML = SliderConfidenceLevelCamera1.value;
            SpanConfidenceLevelCamera2.innerHTML = SliderConfidenceLevelCamera2.value;
            SpanConfidenceLevelCamera3.innerHTML = SliderConfidenceLevelCamera3.value;

            sliderThresholdCamera1.addEventListener("input", processSliderInput, false);
            sliderThresholdCamera2.addEventListener("input", processSliderInput, false);
            sliderThresholdCamera3.addEventListener("input", processSliderInput, false);

            $("input[data-bootstrap-switch]").each(function () {
                $(this).bootstrapSwitch('state', $(this).prop('checked'));
            })

            $('.sidebar-mini').removeClass('sidebar-open');
            $('.sidebar-mini').addClass('sidebar-closed sidebar-collapse');

            initCanvas('canvasCamera1');
            initCanvas('canvasCamera2');
            initCanvas('canvasCamera3');

            document.getElementById("txAreaStatus").value = '';

            // SignalR
            signalRHub = new signalR.HubConnectionBuilder()
                .withUrl("/hub")
                .configureLogging(signalR.LogLevel.Information)
                .build();

            signalRHub.start()
                .then(() => console.log('SignalR connected!'))
                .catch(err => console.log(`Error while establishing a connection : ${err.toString()}`));

            signalRHub.on('deviceTelemetry', function (payload) {
                let jsonData = JSON.parse(payload);
                let jsonPretty = JSON.stringify(jsonData, undefined, 2);
                let timeStamp = getDate(jsonData["T"]);
                console.debug(`deviceTelemetry ${jsonPretty}`);
                document.getElementById("txAreaStatus").value += `${timeStamp} Telemetry : ${jsonPretty}\r\n`;
            });


            //document.getElementById("camera_1_name").innerHTML = '@(ViewData["Camera_1_ID"])';
            //document.getElementById("camera_2_name").innerHTML = '@(ViewData["Camera_2_ID"])';
            //document.getElementById("camera_3_name").innerHTML = '@(ViewData["Camera_3_ID"])';

            UpdateCameraNames('@(ViewData["Camera_1_ID"])', '@(ViewData["Camera_2_ID"])', '@(ViewData["Camera_3_ID"])');
           
        });

        function getDate(dateString) {
            var date = new Date(Date.UTC(dateString.substr(0, 4), dateString.substr(4, 2), dateString.substr(6, 2), dateString.substr(8, 2), dateString.substr(10, 2), dateString.substr(12, 2), dateString.substr(14, 3)));
            return date;
        }

        $('#btnClearLogs').click(function (evt) {
            document.getElementById('txAreaStatus').value = null;
            var message = '@ViewData["Camera_1_ID"]';
            console.debug(message);
        })

    </script>
}